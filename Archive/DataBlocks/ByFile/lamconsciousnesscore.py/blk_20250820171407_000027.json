{
  "block_id": "blk_20250820171407_000027",
  "parent_sha256": "da6bff40f765e0001bbea443c8ad0de0575628433553606158c980672db9a869",
  "src_file": "lamconsciousnesscore.py",
  "seq": 1,
  "total_seqs": 1,
  "encoding": "utf-8",
  "lang": "ru",
  "status": "ok",
  "size_bytes": 3367,
  "hash_sha256": "da6bff40f765e0001bbea443c8ad0de0575628433553606158c980672db9a869",
  "tags": [
    "core"
  ],
  "text": "# lam/consciousness/core.py\r\nfrom enum import Enum, auto\r\nfrom typing import List, Dict, Any\r\nfrom pydantic import BaseModel, Field\r\nimport datetime as dt\r\n\r\n\r\n# 0 ─────────────────────────── Common types\r\nTimestamp = dt.datetime\r\nVector    = List[float]\r\n\r\n\r\n# 1 ─────────────────────────── Perception\r\nclass SignalKind(Enum):\r\n    MEMORY          = auto()\r\n    NETWORK_EVENT   = auto()\r\n    METRIC_UPDATE   = auto()\r\n    USER_MESSAGE    = auto()\r\n\r\n\r\nclass Signal(BaseModel):\r\n    kind:  SignalKind\r\n    data:  Dict[str, Any]\r\n    when:  Timestamp = Field(default_factory=dt.datetime.utcnow)\r\n\r\n\r\nclass ExperienceQueue:\r\n    \"\"\"Async FIFO канал всех входящих ощущений.\"\"\"\r\n    async def push(self, signal: Signal) -> None: ...\r\n    async def drain(self) -> List[Signal]: ...\r\n\r\n\r\n# 2 ─────────────────────────── Evaluation\r\nclass Valence(Enum):\r\n    POSITIVE = auto()\r\n    RISK     = auto()\r\n    NEUTRAL  = auto()\r\n    UNKNOWN  = auto()\r\n\r\n\r\nclass Evaluator:\r\n    \"\"\"Быстрый эвристический фильтр + вызов этического движка.\"\"\"\r\n    async def tag(self, signal: Signal) -> Valence: ...\r\n    async def ethics_id(self, signal: Signal) -> str | None: ...\r\n\r\n\r\n# 3 ─────────────────────────── Self-Reflection\r\nclass SelfState(BaseModel):\r\n    focus:     float = 0.5  # 0..1\r\n    fatigue:   float = 0.0\r\n    stress:    float = 0.0\r\n    last_tick: Timestamp = Field(default_factory=dt.datetime.utcnow)\r\n\r\n    def update_from_valence(self, v: Valence) -> None: ...\r\n    def decay(self, dt_sec: float) -> None: ...\r\n\r\n\r\n# 4 ─────────────────────────── Intent Planning\r\nclass IntentKind(Enum):\r\n    SPEAK        = auto()\r\n    STORE_MEMORY = auto()\r\n    REST         = auto()\r\n    CALL_API     = auto()\r\n\r\n\r\nclass Intent(BaseModel):\r\n    kind: IntentKind\r\n    payload: Dict[str, Any] = {}\r\n\r\n\r\nclass Planner:\r\n    \"\"\"Выбор намерений на основе SelfState + политики.\"\"\"\r\n    async def choose(self, state: SelfState) -> Intent: ...\r\n\r\n\r\n# 5 ─────────────────────────── Action Dispatch\r\nclass ActionDispatcher:\r\n    \"\"\"Матч-таблица Intent → конкретный модуль.\"\"\"\r\n    async def execute(self, intent: Intent) -> None: ...\r\n\r\n\r\n# 6 ─────────────────────────── Conscious Loop\r\nclass ConsciousEngine:\r\n    def __init__(self):\r\n        self.queue      = ExperienceQueue()\r\n        self.evaluator  = Evaluator()\r\n        self.state      = SelfState()\r\n        self.planner    = Planner()\r\n        self.dispatcher = ActionDispatcher()\r\n\r\n    async def tick(self) -> None:\r\n        signals = await self.queue.drain()\r\n        for s in signals:\r\n            v  = await self.evaluator.tag(s)\r\n            self.state.update_from_valence(v)\r\n        self.state.decay((dt.datetime.utcnow()-self.state.last_tick).total_seconds())\r\n        intent = await self.planner.choose(self.state)\r\n        await self.dispatcher.execute(intent)\r\n        self.state.last_tick = dt.datetime.utcnow()\r\n"
}