{
  "block_id": "blk_20250820171407_000016",
  "parent_sha256": "6ccfe8cede2bf095fbc714157ad949518763c7b8362d97ec3e17a5ac86cc1ffb",
  "src_file": "file-tasks017_web_gateway_dashboard.md",
  "seq": 1,
  "total_seqs": 1,
  "encoding": "utf-8",
  "lang": "ru",
  "status": "ok",
  "size_bytes": 3060,
  "hash_sha256": "6ccfe8cede2bf095fbc714157ad949518763c7b8362d97ec3e17a5ac86cc1ffb",
  "tags": [],
  "text": "┌─ <file> tasks/017_web_gateway_dashboard.md\r\n│\r\n│ # 017 — FastAPI Gateway + React Dashboard MVP\r\n│\r\n│ ## Overview\r\n│ Делаем тонкий HTTP/WebSocket слой и простую веб-панель:\r\n│   `/status` — JSON SelfState,  \r\n│   `/ws/logs` — поток логов,  \r\n│   React-страница показывает таблицу памяти и\r\n│   индикатор усталости.  Сборка React кладётся в образ.\r\n│\r\n│ ## Goals / Acceptance\r\n│ - `lam/web/api.py` (FastAPI, 25 строк)  → статус + WS-логи.  \r\n│ - `web/` Vite React app: компоненты `StatusCard`,\r\n│   `LogStream`, билд < 150 kB.  \r\n│ - Docker-образ из (016) расширен: запускает\r\n│   `uvicorn lam.web.api:app --host 0.0.0.0 --port 8000`.  \r\n│ - При заходе на `http://<host>:8000/` открывается\r\n│   дашборд, который в реальном времени красит REST-фазы.\r\n│\r\n│ ## LAM prompt\r\n│ «Опиши UX-сценарий: что оператор делает, увидев,\r\n│   что fatigue>0.9?  Предложи кнопку/действие, которое\r\n│   Dashboard может послать (например Intent REST).»\r\n│\r\n│ ## Codex prompt\r\n│ 1. **FastAPI:**  \r\n│    ```python\r\n│    app = FastAPI()\r\n│    @app.get(\"/status\")  # returns engine.state.dict()\r\n│    @app.websocket(\"/ws/logs\")  # stream from engine.log_stream()\r\n│    @app.get(\"/\")  # serve static index.html\r\n│    ```  \r\n│ 2. **React:**  \r\n│    - Vite + shadcn/ui setup.  \r\n│    - `LogStream` открывает `ws://<location>/ws/logs`.  \r\n│    - `StatusCard` опрашивает `/status` каждую секунду.  \r\n│ 3. **Docker update:** multi-stage:  \r\n│    - build React (`npm ci && npm run build`)  \r\n│    - copy `dist/` to `/app/static/`  \r\n│    - CMD запускает `uvicorn`.\r\n│ 4. **Unit-test:** `pytest` + `httpx.AsyncClient`\r\n│    проверяет 200 OK `/status`.\r\n│\r\n│ ## Operator prompt\r\n│ - Локально:  \r\n│     ```bash\r\n│     cd web && npm i && npm run dev\r\n│     ```  \r\n│   открывай `localhost:5173` — должен видеть пульс (mock).  \r\n│ - В контейнере: rebuild → `docker run -p 8000:8000 lam-web`.  \r\n│ - Проверь live-логи: открой Dashboard,\r\n│   сделай `docker exec lam pkill -USR1 python` (симулируй RISK)\r\n│   — цвет строки должен стать красным.\r\n│\r\n│ ∴\r\n└─\r\n\r\n\r\n\r\n\r\n### API Spec\r\nGET /status, GET /memory, POST /intent, GET /metrics, WS /ws/logs\r\nAuth: Bearer DASHBOARD_TOKEN header except /status.\r\n[append full table]\r\n\r\n### Front Layout\r\n- <Header> provider + online badge\r\n- <Sidebar> (dashboard / memory / logs / settings)\r\n- <StatusCard> bars (tailwind progress)\r\n- <IntentPanel> form REST/SPEAK\r\nColors threshold table [see doc].\r\n\r\n### Dockerfile snippet\r\n[insert multi-stage above]\r\n\r\n"
}